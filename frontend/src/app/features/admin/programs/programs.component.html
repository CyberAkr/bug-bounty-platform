<div class="mx-auto max-w-7xl p-6 space-y-6">
  <header class="flex items-center justify-between">
    <h1 class="text-2xl font-semibold">{{ 'admin.programs.title' | translate }}</h1>

    <div class="flex items-center gap-2">
      <label class="text-sm text-gray-600">{{ 'admin.programs.filter.label' | translate }}</label>
      <select class="border rounded p-1 text-sm"
              [ngModel]="filter()"
              (ngModelChange)="setFilter($event)">
        <option value="">{{ 'admin.programs.filter.all' | translate }}</option>
        <option value="PENDING">{{ 'admin.programs.status.PENDING' | translate }}</option>
        <option value="APPROVED">{{ 'admin.programs.status.APPROVED' | translate }}</option>
        <option value="ARCHIVED">{{ 'admin.programs.status.ARCHIVED' | translate }}</option>
      </select>
      <button class="px-3 py-1.5 rounded border text-sm" (click)="load()">
        {{ 'common.refresh' | translate }}
      </button>
    </div>
  </header>

  <!-- CrÃ©ation -->
  <section class="rounded-xl border p-4">
    <h2 class="font-medium mb-3">{{ 'admin.programs.create.title' | translate }}</h2>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
      <input class="border rounded p-2 text-sm"
             [placeholder]="'admin.programs.create.placeholders.title' | translate"
             [ngModel]="newProg().title"
             (ngModelChange)="updateNew({ title: $event })" />

      <input class="border rounded p-2 text-sm sm:col-span-2"
             [placeholder]="'admin.programs.create.placeholders.description' | translate"
             [ngModel]="newProg().description"
             (ngModelChange)="updateNew({ description: $event })" />

      <input class="border rounded p-2 text-sm"
             type="number"
             [placeholder]="'admin.programs.create.placeholders.companyId' | translate"
             [ngModel]="newProg().companyId"
             (ngModelChange)="updateNew({ companyId: toNumber($event) })" />

      <select class="border rounded p-2 text-sm"
              [ngModel]="newProg().status"
              (ngModelChange)="updateNew({ status: $event || undefined })">
        <option [ngValue]="undefined">{{ 'admin.programs.create.defaults.pending' | translate }}</option>
        <option value="PENDING">{{ 'admin.programs.status.PENDING' | translate }}</option>
        <option value="APPROVED">{{ 'admin.programs.status.APPROVED' | translate }}</option>
        <option value="ARCHIVED">{{ 'admin.programs.status.ARCHIVED' | translate }}</option>
      </select>
    </div>

    <div class="mt-3">
      <button (click)="onCreate()"
              class="bg-emerald-600 hover:bg-emerald-700 text-white text-sm px-4 py-2 rounded"
              [disabled]="!canCreate()">
        {{ 'admin.programs.create.submit' | translate }}
      </button>
    </div>
  </section>

  @if (loading()) {
    <div class="rounded-xl border p-6 animate-pulse">
      <div class="h-4 bg-gray-200 rounded w-1/3 mb-4"></div>
      <div class="h-3 bg-gray-200 rounded w-full mb-2"></div>
      <div class="h-3 bg-gray-200 rounded w-5/6"></div>
    </div>
  } @else {
    @if (programs().length) {
      <div class="rounded-xl border overflow-x-auto">
        <table class="w-full table-fixed text-sm border-collapse">
          <colgroup>
            <col class="w-[20%]" /><col class="w-[34%]" /><col class="w-[18%]" />
            <col class="w-[14%]" /><col class="w-[14%]" />
          </colgroup>
          <thead class="bg-gray-50">
          <tr class="text-left">
            <th class="px-4 py-2 font-medium text-gray-600 sticky top-0 bg-gray-50">
              {{ 'admin.programs.table.col.title' | translate }}
            </th>
            <th class="px-4 py-2 font-medium text-gray-600 sticky top-0 bg-gray-50">
              {{ 'admin.programs.table.col.description' | translate:{ max: 15 } }}
            </th>
            <th class="px-4 py-2 font-medium text-gray-600 sticky top-0 bg-gray-50">
              {{ 'admin.programs.table.col.company' | translate }}
            </th>
            <th class="px-4 py-2 font-medium text-gray-600 sticky top-0 bg-gray-50">
              {{ 'admin.programs.table.col.status' | translate }}
            </th>
            <th class="px-4 py-2 font-medium text-gray-600 sticky top-0 bg-gray-50">
              {{ 'admin.programs.table.col.actions' | translate }}
            </th>
          </tr>
          </thead>
          <tbody>
            @for (p of programs(); track p.program_id ?? $index) {
              <tr app-program-row
                  [program]="p"
                  (approve)="onApprove($event.id)"
                  (update)="onUpdate($event)"
                  (removed)="onDelete($event)">
              </tr>
            }
          </tbody>
        </table>
      </div>
    } @else {
      <div class="rounded-xl border p-10 text-center">
        <div class="text-lg font-medium">{{ 'admin.programs.empty' | translate }}</div>
      </div>
    }
  }

  @if (error()) {
    <div class="rounded-xl border border-red-300 bg-red-50 text-red-700 p-4">
      {{ error() }}
    </div>
  }
</div>
