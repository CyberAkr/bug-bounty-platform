<div class="mx-auto max-w-7xl p-6 space-y-6">
  <header class="flex items-center justify-between">
    <h1 class="text-2xl font-semibold">{{ 'admin.users.title' | translate }}</h1>
  </header>

  <!-- CrÃ©ation -->
  <section class="rounded-xl border p-4 bg-white">
    <h2 class="font-medium mb-3">{{ 'admin.users.create.title' | translate }}</h2>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
      <input class="border rounded p-2 text-sm" [placeholder]="'admin.users.create.firstName' | translate" [(ngModel)]="newUser().firstName">
      <input class="border rounded p-2 text-sm" [placeholder]="'admin.users.create.lastName' | translate" [(ngModel)]="newUser().lastName">
      <input class="border rounded p-2 text-sm" placeholder="Username" [(ngModel)]="newUser().username">
      <input class="border rounded p-2 text-sm" placeholder="Email" [(ngModel)]="newUser().email" type="email">
      <input class="border rounded p-2 text-sm" [placeholder]="'admin.users.create.password' | translate" [(ngModel)]="newUser().password" type="password">

      <select class="border rounded p-2 text-sm" [(ngModel)]="newUser().role">
        <option value="researcher">{{ 'admin.users.role.researcher' | translate }}</option>
        <option value="company">{{ 'admin.users.role.company' | translate }}</option>
        <option value="admin">{{ 'admin.users.role.admin' | translate }}</option>
      </select>

      <select class="border rounded p-2 text-sm" [(ngModel)]="newUser().verificationStatus">
        <option value="PENDING">{{ 'admin.users.verif.PENDING' | translate }}</option>
        <option value="APPROVED">{{ 'admin.users.verif.APPROVED' | translate }}</option>
        <option value="REJECTED">{{ 'admin.users.verif.REJECTED' | translate }}</option>
      </select>

      <label class="inline-flex items-center gap-2 text-sm">
        <input type="checkbox" [(ngModel)]="newUser().banned"> {{ 'admin.users.banned' | translate }}
      </label>

      @if (newUser().role === 'company') {
        <input class="border rounded p-2 text-sm sm:col-span-2"
               [placeholder]="'admin.users.create.companyNumber' | translate"
               [(ngModel)]="newUser().companyNumber">
        <input class="border rounded p-2 text-sm sm:col-span-2"
               [placeholder]="'admin.users.create.verificationDoc' | translate"
               [(ngModel)]="newUser().verificationDocument">
      }
    </div>

    <div class="mt-3">
      <button (click)="onCreate()"
              class="bg-emerald-600 hover:bg-emerald-700 text-white text-sm px-4 py-2 rounded"
              [disabled]="!canCreate()">
        {{ 'common.create' | translate }}
      </button>
    </div>
  </section>

  @if (loading()) {
    <div class="rounded-xl border p-6 bg-white animate-pulse">
      <div class="h-4 bg-gray-200 rounded w-1/3 mb-4"></div>
      <div class="h-3 bg-gray-200 rounded w-full mb-2"></div>
      <div class="h-3 bg-gray-200 rounded w-5/6"></div>
    </div>
  } @else {
    @if (users().length) {
      <div class="rounded-xl border overflow-x-auto bg-white">
        <table class="w-full table-fixed text-sm border-collapse">
          <colgroup>
            <col class="w-[18%]" />
            <col class="w-[24%]" />
            <col class="w-[20%]" />
            <col class="w-[12%]" />
            <col class="w-[10%]" />
            <col class="w-[16%]" />
          </colgroup>
          <thead class="bg-gray-50">
          <tr class="text-left">
            <th class="px-4 py-2 font-medium text-gray-600 sticky top-0 bg-gray-50">Username</th>
            <th class="px-4 py-2 font-medium text-gray-600 sticky top-0 bg-gray-50">Email</th>
            <th class="px-4 py-2 font-medium text-gray-600 sticky top-0 bg-gray-50">{{ 'admin.users.table.roleStatus' | translate }}</th>
            <th class="px-4 py-2 font-medium text-gray-600 sticky top-0 bg-gray-50">{{ 'admin.users.table.verification' | translate }}</th>
            <th class="px-4 py-2 font-medium text-gray-600 sticky top-0 bg-gray-50">{{ 'admin.users.table.document' | translate }}</th>
            <th class="px-4 py-2 font-medium text-gray-600 sticky top-0 bg-gray-50">{{ 'admin.users.table.actions' | translate }}</th>
          </tr>
          </thead>
          <tbody>
            @for (u of users(); track trackUser($index, u)) {
              <tr app-user-row
                  [user]="u"
                  (update)="onUpdate($event)"
                  (removed)="onDelete($event)"
                  (downloadDoc)="onDownload($event)">
              </tr>
            }
          </tbody>
        </table>
      </div>
    } @else {
      <div class="rounded-xl border p-10 text-center bg-white">
        <div class="text-lg font-medium">{{ 'admin.users.empty' | translate }}</div>
      </div>
    }
  }

  @if (error()) {
    <div class="rounded-xl border border-red-300 bg-red-50 text-red-700 p-4">
      {{ error() }}
    </div>
  }
</div>
