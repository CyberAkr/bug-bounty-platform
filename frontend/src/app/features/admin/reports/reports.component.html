<section class="p-4">
  <div class="list-toolbar flex flex-wrap items-center gap-4 mb-4">
    <!-- Notre composant rÃ©utilisable -->
    <app-list-controls
      class="flex-1 min-w-[280px]"
      [total]="totalSig()"
      [pageIndex]="pageIndexSig()"
      [pageSize]="pageSizeSig()"
      [pageSizeOptions]="pageSizeOptions"
      [query]="querySig()"
      [sort]="sortSig()"
      [sortOptionsInput]="sortOptions"
      (change)="onControlsChange($event)">
    </app-list-controls>

    <!-- Filtre de statut (dans la mÃªme barre) -->
    <mat-form-field appearance="fill" class="w-48">
      <mat-label>{{ 'admin.reports.filter.label' | translate }}</mat-label>
      <mat-select [value]="statusSig()" (selectionChange)="onStatus($event.value)">
        <mat-option [value]="''">{{ 'admin.reports.filter.all' | translate }}</mat-option>
        <mat-option value="PENDING">{{ 'admin.reports.status.PENDING' | translate }}</mat-option>
        <mat-option value="APPROVED">{{ 'admin.reports.status.APPROVED' | translate }}</mat-option>
        <mat-option value="REJECTED">{{ 'admin.reports.status.REJECTED' | translate }}</mat-option>
      </mat-select>
    </mat-form-field>

    <button class="border rounded px-3 py-2 text-sm" (click)="reload()">
      {{ 'common.refresh' | translate }}
    </button>
  </div>

  <!-- Loading -->
  <div *ngIf="loading()" class="text-sm text-slate-600">
    {{ 'common.loading' | translate }}
  </div>

  <!-- Empty -->
  <div *ngIf="!loading() && pageRows().length === 0" class="text-sm text-slate-500">
    {{ 'admin.reports.empty' | translate }}
  </div>

  <!-- Table -->
  <div class="overflow-auto" *ngIf="!loading() && pageRows().length > 0">
    <table class="min-w-full text-sm border-collapse">
      <thead>
      <tr class="text-left border-b">
        <th class="px-4 py-2">{{ 'admin.reports.table.id' | translate }}</th>
        <th class="px-4 py-2">{{ 'admin.reports.table.report' | translate }}</th>
        <th class="px-4 py-2">{{ 'admin.reports.table.researcher' | translate }}</th>
        <th class="px-4 py-2">{{ 'admin.reports.table.submitted' | translate }}</th>
        <th class="px-4 py-2">{{ 'admin.reports.table.vulnType' | translate }}</th>
        <th class="px-4 py-2">{{ 'admin.reports.table.comment' | translate }}</th>
        <th class="px-4 py-2">{{ 'admin.reports.table.actions' | translate }}</th>
      </tr>
      </thead>
      <tbody>
      <tr app-report-row
          *ngFor="let r of pageRows(); trackBy: track"
          [report]="r"
          [vulnerabilities]="vulns()"
          (preview)="onPreview($event)"
          (approve)="onApprove($event.id, $event.comment)"
          (reject)="onReject($event.id, $event.comment)"
          (saveVulnerability)="onSaveVuln($event.reportId, $event.vulnerabilityId)">
      </tr>
      </tbody>
    </table>
  </div>
</section>
