<div class="auth-wrapper">
  <div class="auth-card mx-auto">
    <div class="text-center mb-6">
      <span class="material-icons text-[var(--accent)] text-4xl mb-2">lock_reset</span>
      <h2 class="text-xl font-semibold">{{ 'auth.reset.confirmTitle' | translate }}</h2>
      <p class="text-sm opacity-80">{{ 'auth.reset.confirmHint' | translate }}</p>
    </div>

    <form (ngSubmit)="submit()" class="space-y-4" novalidate>
      <!-- Email -->
      <mat-form-field appearance="fill" class="w-full">
        <mat-label>{{ 'auth.login.email' | translate }}</mat-label>
        <mat-icon matPrefix>mail</mat-icon>
        <input
          matInput type="email" name="email"
          [ngModel]="email()" (ngModelChange)="email.set($event)"
          required email autocomplete="email"
        />
      </mat-form-field>

      <!-- Code -->
      <mat-form-field appearance="fill" class="w-full">
        <mat-label>{{ 'auth.reset.code' | translate }}</mat-label>
        <mat-icon matPrefix>pin</mat-icon>
        <input
          matInput name="code"
          [ngModel]="code()" (ngModelChange)="code.set($event)"
          required inputmode="numeric" pattern="\\d{6}" maxlength="6"
          placeholder="••••••"
        />
      </mat-form-field>

      <!-- Nouveau mot de passe -->
      <mat-form-field appearance="fill" class="w-full">
        <mat-label>{{ 'auth.reset.newPassword' | translate }}</mat-label>
        <mat-icon matPrefix>lock</mat-icon>
        <input
          matInput type="password" name="password"
          [ngModel]="password()" (ngModelChange)="onPasswordInput($event)"
          required [attr.pattern]="PASSWORD_REGEX" [attr.minlength]="8"
          autocomplete="new-password"
        />
        <mat-hint>{{ 'auth.register.passwordRules.hint' | translate }}</mat-hint>
      </mat-form-field>

      <!-- Confirmation -->
      <mat-form-field appearance="fill" class="w-full">
        <mat-label>{{ 'auth.register.confirmPassword' | translate }}</mat-label>
        <mat-icon matPrefix>verified_user</mat-icon>
        <input
          matInput type="password" name="confirm"
          [ngModel]="confirm()" (ngModelChange)="confirm.set($event)"
          required autocomplete="new-password"
        />
      </mat-form-field>

      <!-- Feedback visuel des règles -->
      <div>
        <div class="pw-rules">
          <span class="pw-chip" [class.pw-chip--ok]="hasMinLength()">{{ 'auth.register.passwordRules.min' | translate }}</span>
          <span class="pw-chip" [class.pw-chip--ok]="hasLower()">{{ 'auth.register.passwordRules.lower' | translate }}</span>
          <span class="pw-chip" [class.pw-chip--ok]="hasUpper()">{{ 'auth.register.passwordRules.upper' | translate }}</span>
          <span class="pw-chip" [class.pw-chip--ok]="hasDigit()">{{ 'auth.register.passwordRules.digit' | translate }}</span>
          <span class="pw-chip" [class.pw-chip--ok]="hasSpecial()">{{ 'auth.register.passwordRules.special' | translate }}</span>
          <span class="pw-chip" [class.pw-chip--ok]="passwordsMatch()">{{ 'auth.register.passwordRules.match' | translate }}</span>
        </div>
      </div>

      <div class="form-actions">
        <a routerLink="/login" class="btn-ghost mat-mdc-button">
          {{ 'verify.backToLogin' | translate }}
        </a>

        <button
          mat-flat-button color="primary"
          class="btn-primary flex items-center gap-2"
          type="submit"
          [disabled]="loading()"
        >
          <mat-icon *ngIf="loading()" class="animate-spin">hourglass_top</mat-icon>
          {{ loading() ? ('auth.reset.loading' | translate) : ('auth.reset.submit' | translate) }}
        </button>
      </div>
    </form>

    <p class="success-text text-center mt-4" *ngIf="success()">{{ success() | translate }}</p>
    <p class="error-text text-center mt-2" *ngIf="error()">{{ error() | translate }}</p>
  </div>
</div>
