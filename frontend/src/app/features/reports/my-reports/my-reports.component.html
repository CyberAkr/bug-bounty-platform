<div class="reports-wrapper">
  <div class="reports-card">
    <header class="reports-head">
      <h2 class="reports-title">{{ 'reports.my.title' | translate }}</h2>
    </header>

    <div class="reports-state" *ngIf="loading()">
      <mat-progress-spinner mode="indeterminate" diameter="28"></mat-progress-spinner>
      <span>{{ 'common.loading' | translate }}</span>
    </div>

    <div class="reports-empty" *ngIf="!loading() && reports().length === 0">
      {{ 'reports.my.empty' | translate }}
    </div>

    <div class="space-y-3" *ngIf="!loading() && reports().length > 0">
      <mat-card class="card" *ngFor="let r of reports()">
        <mat-card-title class="text-base font-semibold">{{ r.title }}</mat-card-title>
        <mat-card-content class="text-sm space-y-1">
          <div><b>{{ 'reports.labels.program' | translate }}:</b> {{ r.programTitle }}</div>
          <div><b>{{ 'reports.labels.severity' | translate }}:</b> {{ r.severity }}</div>
          <div><b>{{ 'reports.labels.status' | translate }}:</b> {{ r.status }}</div>
          <div><b>{{ 'reports.labels.submittedAt' | translate }}:</b> {{ r.submittedAt | dateFormat:{ withTime:true } }}</div>

          <ng-container *ngIf="rewardsMap()[r.id] as rw; else noReward">
            <div><b>{{ 'reports.labels.reward' | translate }}:</b>
              {{ rw.amount | number:'1.2-2' }} € ({{ rw.paymentDate | dateFormat:{ withTime:true } }})
            </div>
          </ng-container>
          <ng-template #noReward>
            <div class="text-slate-500">
              <b>{{ 'reports.labels.reward' | translate }}:</b> —
            </div>
          </ng-template>
        </mat-card-content>

        <mat-card-actions class="mt-2">
          <button mat-stroked-button (click)="downloadMine(r.id)">
            <mat-icon>download</mat-icon>
            <span>{{ 'reports.actions.downloadMine' | translate }}</span>
          </button>
        </mat-card-actions>
      </mat-card>
    </div>
  </div>
</div>
