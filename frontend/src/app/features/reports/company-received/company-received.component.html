<section class="auth-wrapper">
  <mat-card class="auth-card reports-card">
    <header class="flex items-center justify-between gap-4 border-b pb-3">
      <h2 class="reports-title m-0 text-xl font-semibold">
        {{ 'reports.received.title' | translate }}
      </h2>

      <button
        mat-icon-button
        class="btn-ghost"
        (click)="refresh()"
        [attr.aria-label]="'reports.actions.refresh' | translate">
        <mat-icon>refresh</mat-icon>
      </button>
    </header>

    <!-- Toolbar: search / sort / page size / paginator -->
    <app-list-controls
      class="mt-4"
      [total]="totalSig()"
      [pageIndex]="pageIndexSig()"
      [pageSize]="pageSizeSig()"
      [query]="querySig()"
      [sort]="sortSig()"
      [pageSizeOptions]="pageSizeOptions"
      [sortOptionsInput]="sortOptions"
      (change)="onControlsChange($event)">
    </app-list-controls>

    <!-- Loading -->
    <div class="reports-state" *ngIf="loading()">
      <mat-progress-spinner mode="indeterminate" diameter="28"></mat-progress-spinner>
      <span>{{ 'common.loading' | translate }}</span>
    </div>

    <!-- Error -->
    <div class="reports-error" *ngIf="!loading() && error()">
      <mat-icon>error_outline</mat-icon>
      <span>{{ error() }}</span>
    </div>

    <!-- Empty -->
    <div class="reports-empty" *ngIf="!loading() && !error() && totalSig() === 0">
      {{ 'reports.received.empty' | translate }}
    </div>

    <!-- Grid paginÃ©e -->
    <div *ngIf="!loading() && !error() && totalSig() > 0"
         class="grid gap-4 md:grid-cols-2 xl:grid-cols-2 reports-grid">
      <mat-card
        class="report-item"
        *ngFor="let r of pagedReports(); trackBy: trackById">
        <div class="item-top">
          <div class="item-title">{{ r.title }}</div>
          <span class="status-chip"
                [style.borderColor]="(r.status | statusColor)"
                [style.color]="(r.status | statusColor)">
            {{ r.status }}
          </span>
        </div>

        <div class="item-meta">
          <div class="meta-row">
            <span class="meta-label">{{ 'reports.labels.program' | translate }}</span>
            <span class="meta-value">{{ r.programTitle }}</span>
          </div>

          <div class="meta-row" *ngIf="r.severity">
            <span class="meta-label">{{ 'reports.labels.severity' | translate }}</span>
            <span class="meta-value font-semibold">{{ r.severity }}</span>
          </div>

          <div class="meta-row">
            <span class="meta-label">{{ 'reports.labels.receivedAt' | translate }}</span>
            <span class="meta-value">{{ r.submittedAt | dateFormat }}</span>
          </div>

          <div class="meta-row" *ngIf="r.researcher">
            <span class="meta-label">{{ 'reports.labels.researcher' | translate }}</span>
            <span class="meta-value">{{ r.researcher }}</span>
          </div>
        </div>

        <div class="item-actions">
          <button
            mat-stroked-button
            class="btn-primary btn-wide"
            [disabled]="r.status !== 'APPROVED'"
            (click)="download(r)">
            <mat-icon>download</mat-icon>
            <span>{{ 'reports.actions.download' | translate }}</span>
          </button>
        </div>
      </mat-card>
    </div>
  </mat-card>
</section>
